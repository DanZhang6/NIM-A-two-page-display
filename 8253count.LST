C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 1   


C51 COMPILER V7.08, COMPILATION OF MODULE 8253COUNT
OBJECT MODULE PLACED IN 8253count.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 8253count.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /********************************************************************************************
   2          *ÃèÊö£º
   3          *      8253¼ÆÊýÉèÖÃ
   4          *¹¦ÄÜ£º 
   5          *    1. ´Ó8253ÖÐ¶ÁÈ¡¼ÆÊý£¬Ã¿¸ö8253ÖÐº¬ÓÐ3¸ö¼ÆÊýÆ÷£¬Îå¸ö8253¼Æ15¸öÌ½Í·µÄ¼ÆÊý£¬ 
   6          *       Ç°Æß¸öÌ½Í·ÊÇË«Ì½Í·£¨µÍ¼ÆÊýÌ½Í·ºÍ¸ß¼ÆÊýÌ½Í·£©£¬µÚ°Ë¸öÌ½Í·ÊÇµ¥Ì½Í·£¨¸ß¼ÆÊýÌ½Í·£©£¬
   7          *       ¸ù¾Ý¼ÆÊýÂÊÑ¡ÔñÄÄ¸öÌ½Í·¹¤×÷£»
   8          *    2. T0¶¨Ê±ÖÐ¶Ï
   9          *       T0¹¤×÷ÔÚ16Î»×Ô¶¯ÖØÔØÄ£Ê½£¬ÏòÉÏ¼ÆÊý£¬Ã¿Ñ­»·Ò»´Î£¬×Ü¶¨Ê±5Ms, ¼ÆÊý³õÖµDC00£¬¾§Õñ22.1184M£»
  10          *    3. ¶¨Ê±µ½£¬¶ÁÈ¡¼ÆÊý£¬¸ù¾ÝÉè¶¨µÄ²ÎÊý£¬ÏÔÊ¾¸÷Ì½Í·µÄ¼ÆÊýÂÊ£»       
  11          *    4. ¸ù¾Ý¼ÆÊýÂÊµÄ²»Í¬£¬Ñ¡Ôñ²»Í¬µÄµ¥Î»£¨uGy/s,mGy/s,Gy/s£©;
  12             
  13          ***********************************************************************************************/
  14          #include "STC12C5A60S2.h"
  15          #include "intrins.h"
  16          #include "config.h" 
  17          #include "absacc.h"
  18          #include "stdio.h"
  19          #include "math.h"
  20          
  21          #define  C82531C  XBYTE[0x8300] //8253µÄÃüÁî¶Ë¿Ú£¨µØÖ·£©£¬ CS4=1,CS3=1,CS2=1,CS1=1,CS0=0,A1A0=11£»
  22          #define  C825310D XBYTE[0x8000] //¼ÆÊýÆ÷0                                  CS4=1,CS3=1,CS2=1,CS1=1,CS0=0,A1A0=00£»
  23          #define  C825311D XBYTE[0x8100] //¼ÆÊýÆ÷1                  CS4=1,CS3=1,CS2=1,CS1=1,CS0=0,A1A0=01;
  24          #define  C825312D XBYTE[0x8200] //¼ÆÊýÆ÷2                                  CS4=1,CS3=1,CS2=1,CS1=1,CS0=0,A1A0=10;
  25          
  26          #define  C82532C  XBYTE[0x8b00] //XBYTEµÄ×÷ÓÃÊÇ½«Íâ²¿I/O¶Ë¿ÚÖÃÎªÖÐÀ¨ºÅÄÚ²¿µÄ16Î»¶þ½øÖÆ£¬¼´ÎªÉèÖÃ
  27          #define  C825320D XBYTE[0x8800] //Ê¹ÄÜ¶Ë£¬XBYTEµÄ×÷ÓÃ»¹ÓÐÉèÖÃÊ¹ÄÜ¶Ëºó£¬×Ô¶¯ÉèÖÃwr,rd.
  28          #define  C825321D XBYTE[0x8900]
  29          #define  C825322D XBYTE[0x8a00] 
  30          
  31          #define  C82533C  XBYTE[0x9300]
  32          #define  C825330D XBYTE[0x9000]
  33          #define  C825331D XBYTE[0x9100]
  34          #define  C825332D XBYTE[0x9200]
  35          
  36          #define  C82534C  XBYTE[0x9b00]
  37          #define  C825340D XBYTE[0x9800]
  38          #define  C825341D XBYTE[0x9900]
  39          #define  C825342D XBYTE[0x9a00] 
  40          
  41          #define  C82535C  XBYTE[0xa300]
  42          #define  C825350D XBYTE[0xa000]
  43          #define  C825351D XBYTE[0xa100]
  44          #define  C825352D XBYTE[0xa200] 
  45          
  46          uchar  buf[33];                      //´Ó8253ÖÐ¶Áµ½µÄ¼ÆÊýÆ÷Êý¾Ý£¬15¸ö¼ÆÊýÆ÷£¬µÍ°ËÎ»¸ß°ËÎ»£¬´Ó3-32£¬1ÎªÌ½Í·
             -¸öÊý£¬2Îª²âÁ¿Ê±¼ä
  47          uchar  DataGe[75];                   //Ì½²âÆ÷±ê¶¨²ÎÊýµÄ¸öÎ»£¬³õÊ¼Ê±¸öÊ®°ÙÇ§¾ùÎª0
  48          uchar  DataTenth[75];                //Ì½²âÆ÷±ê¶¨²ÎÊýµÄÊ®·ÖÎ»
  49          uchar  DataCent[75];                 //Ì½²âÆ÷±ê¶¨²ÎÊýµÄ°Ù·ÖÎ»
  50          uchar  DataThouth[75];               //Ì½²âÆ÷±ê¶¨²ÎÊýµÄÇ§·ÖÎ»
  51          uchar  send_buf[65];                 //NIM_AÏòNIM_B·¢ËÍÊý¾ÝµÄÊý×é
  52          uchar  Incinput;                     //Ì½Í·¸öÊý±êÖ¾£¬Ä¬ÈÏÏÔÊ¾Ì½Í·¸öÊýÎª8¸ö
  53          float  idata Para[10];               //Éè¶¨ºÃµÄ²ÎÊýÊý×é
  54          float  GDoseRata[8];                  //Ã¿×éÌ½Í·²âµÃµÄ¼ÁÁ¿ÂÊ,GM¼ÆÊý¹ÜµÄ¼ÁÁ¿ÂÊ(2015Äê10ÔÂ20ÈÕ¸Ä)
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 2   

  55          float  DDoseRata[8];                                    //µçÀëÊÒµÄ¼ÆËã¼ÁÁ¿ÂÊ(2015Äê10ÔÂ20ÈÕ¼Ó)
  56          float  DoseRata[8];                                             //µ±Ç°Ì½Í·ÓÃÀ´ÅÐ¶ÏµÄ¼ÁÁ¿Öµ
  57          float  TrueRate[8];                                             //µ±Ç°Ì½Í·×¼È·¼ÁÁ¿ÖµËùÔÚµÄÌ½Í·,ÎªÒ»±íÊ¾GM¼ÆÊý¹Ü
  58          float jishuguan_DoseRata;
  59          float dianlishi_DoseRata;
  60          float  GMean_Value[8];                          //Æ½¾ùÖµGM¼ÆÊý¹ÜÆ½¾ùÖµ
  61          float  DMean_Value[8];                          //µçÀëÊÒÆ½¾ùÖµ
  62          float  idata Gsave0[8],Gsave1[8],Gsave2[8];//¼ÆÊý¹ÜÇ°5´ÎDoseRataÊý¾Ý²»Òª£¬save0,1,2ÓÃÀ´¼ÇÂ¼Ç°Ãæ3´ÎµÄDoseRa
             -ta(Ö»Æ½¾ùÈý´ÎµÄÖµ)£¬À´Æ½»¬¼ÆËãÆ½¾ùÖµ!
  63          float  idata Dsave0[8],Dsave1[8],Dsave2[8];//µçÀëÊÒ
  64          
  65          
  66          uchar  GFlag_dw[8];                      //GM¼ÆÊý¹Üµ¥Î»±êÖ¾
  67          uchar  DFlag_dw[8];                                             //µçÀëÊÒµ¥Î»±êÊ¶
  68          uint  idata Tdata[8];                   //Ì½Í·¼ÆÊýÂÊ(2015Äê10ÔÂ20ÈÕÈÃTdataÎª¼ÆÊý¹ÜµÄ¼ÆÊýÖµ)
  69          uint  idata Ddata[8];                   //Ì½Í·¼ÆÊýÂÊ(2015Äê10ÔÂ20ÈÕÈÃDdataÎªµçÀëÊÒµÄ¼ÆÊýÖµ)
  70          uint idata jishuguan_data;                              //±ê¶¨Ê±µÄ¼ÆÊý¹Ü¼ÆÊýÖµÏàµ±ÓÚTdata
  71          uint idata dianlishi_data;                              //±ê¶¨Ê±µÄµçÀëÊÒ¼ÆÊýÖµÏàµ±ÓÚTdata
  72          uchar idata Var_Signal1;             //Ì½Í·¿ØÖÆÐÅºÅ1£¬½Ó¼ÆÊý¹Ü£¬Ä¬ÈÏff¾ù½Ó¼ÆÊý¹Ü
  73          uchar idata Var_Signal2;             //Ì½Í·¿ØÖÆÐÅºÅ2£¬½ÓµçÀëÊÒ£¬Ä¬ÈÏ00£»
  74          uchar idata Var_Signal3;             //Ì½Í·¿ØÖÆÐÅºÅ3£¬½ÓµçÀëÊÒ£¬Ä¬ÈÏ00£»
  75          uchar idata Var_Led;                 //LED±¨¾¯Ö¸Ê¾µÆ,Îª1Ê±Ãð,³õÖµ0xff,
  76          uchar biaoding_input;
  77          bit Flag_Warn_Count;                            //Ä¬ÈÏ0£»
  78          uchar Flag_need_Flash[8];                       //LEDÉÁË¸±êÖ¾
  79          uchar State_Flash[8];
  80          uchar count_change_flag[8];                     //¼ÆÊý¸Ä±ä±êÖ¾£¿
  81          
  82          uchar data Svar1[8]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};     //ÐÅºÅÊý×é
  83          uchar data Svar0[8]={0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F};
  84          extern uchar jishucount;
  85          extern uint  jishu;
  86          extern uint  count;
  87          
  88          
  89          
  90          void shortdelay(uint i);
  91          void Alarm();
  92          void Led_Disp(uchar Num,uchar Flag,uchar State);
  93          void Updata_Flash(uchar j);
  94          extern bit Speak_Alarm();
  95          /*************************************
  96          *           8253¼ÆÊýÖµ
  97          **************************************/           
  98          void GetAndDisdata()                               //Ë¢ÐÂÏÔÊ¾×Ó³ÌÐò
  99          {
 100   1              uchar th=0;                                                                             //8253¸ß8Î»
 101   1              uchar tl=0;                                                                             //8253µÍ°ËÎ»
 102   1              uchar i,j;                                       //bufÊý×é³õÊ¼»¯
 103   1              for(i=0;i<33;i++)
 104   1              {
 105   2                      buf[i]=0;
 106   2              } 
 107   1          for(j=0;j<10;j++)
 108   1              {
 109   2                      Para[j]=0;
 110   2              } 
 111   1              /*===========Ëø´æ8253µÄ¼ÆÊýÖµ==========*/       
 112   1              C82531C=0x84;                                 //Ëø´æµÚÒ»Æ¬8253¼ÆÊýÆ÷2µÄ¼ÆÊýÖµ                            
             -  
 113   1              tl=C825312D;                                                                     //read 8253 16 bits data(first L then H )
 114   1              buf[3]=0xff-tl;
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 3   

 115   1              th=C825312D;    
 116   1              buf[4]=0xff-th;
 117   1              
 118   1              C82531C=0x44;                                 //Ëø´æµÚÒ»Æ¬8253¼ÆÊýÆ÷1µÄ¼ÆÊýÖµ
 119   1              tl=C825311D;                                                                     //read 8253 16 bits data(first L then H )
 120   1              buf[5]=0xff-tl;
 121   1              th=C825311D;
 122   1              buf[6]=0xff-th;
 123   1              
 124   1              C82531C=0x04;                                //Ëø´æµÚÒ»Æ¬8253¼ÆÊýÆ÷0µÄ¼ÆÊýÖµ
 125   1              tl=C825310D;                                                                     //read 8253 16 bits data(first L then H )
 126   1              buf[7]=0xff-tl;
 127   1              th=C825310D;
 128   1              buf[8]=0xff-th;
 129   1      
 130   1              C82532C=0x84;                                //Ëø´æµÚ¶þÆ¬8253¼ÆÊýÆ÷2µÄ¼ÆÊýÖµ
 131   1              tl=C825322D;                                                                     //read 8253 16 bits data(first L then H )
 132   1              buf[9]=0xff-tl;
 133   1              th=C825322D;
 134   1              buf[10]=0xff-th;
 135   1              
 136   1              C82532C=0x44;                                //Ëø´æµÚ¶þÆ¬8253¼ÆÊýÆ÷1µÄ¼ÆÊýÖµ
 137   1              tl=C825321D;                                                                     //read 8253 16 bits data(first L then H )
 138   1              buf[11]=0xff-tl;
 139   1              th=C825321D;
 140   1              buf[12]=0xff-th;
 141   1              
 142   1              C82532C=0x04;                               //Ëø´æµÚ¶þÆ¬8253¼ÆÊýÆ÷0µÄ¼ÆÊýÖµ
 143   1              tl=C825320D;                                                                     //read 8253 16 bits data(first L then H )
 144   1              buf[13]=0xff-tl;
 145   1              th=C825320D;
 146   1              buf[14]=0xff-th;
 147   1              
 148   1              C82533C=0x84;                                //Ëø´æµÚÈýÆ¬8253¼ÆÊýÆ÷2µÄ¼ÆÊýÖµ
 149   1              tl=C825332D;                                                                     //read 8253 16 bits data(first L then H )
 150   1              buf[15]=0xff-tl;
 151   1              th=C825332D;
 152   1              buf[16]=0xff-th;
 153   1              
 154   1              C82533C=0x44;                                //Ëø´æµÚÈýÆ¬8253¼ÆÊýÆ÷1µÄ¼ÆÊýÖµ
 155   1              tl=C825331D;                                                                     //read 8253 16 bits data(first L then H )
 156   1              buf[17]=0xff-tl;
 157   1              th=C825331D;
 158   1              buf[18]=0xff-th;
 159   1              
 160   1              C82533C=0x04;                               //Ëø´æµÚÈýÆ¬8253¼ÆÊýÆ÷0µÄ¼ÆÊýÖµ
 161   1              tl=C825330D;                                                                     //read 8253 16 bits data(first L then H )
 162   1              buf[19]=0xff-tl;
 163   1              th=C825330D;
 164   1              buf[20]=0xff-th;
 165   1              
 166   1              C82534C=0x84;                                //Ëø´æµÚËÄÆ¬8253¼ÆÊýÆ÷2µÄ¼ÆÊýÖµ
 167   1              tl=C825342D;                                                                     //read 8253 16 bits data(first L then H )
 168   1              buf[21]=0xff-tl;
 169   1              th=C825342D;
 170   1              buf[22]=0xff-th;
 171   1              
 172   1              C82534C=0x44;                                //Ëø´æµÚËÄÆ¬8253¼ÆÊýÆ÷1µÄ¼ÆÊýÖµ
 173   1              tl=C825341D;                                                                     //read 8253 16 bits data(first L then H )
 174   1              buf[23]=0xff-tl;
 175   1              th=C825341D;
 176   1              buf[24]=0xff-th;
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 4   

 177   1              
 178   1              C82534C=0x04;                               //Ëø´æµÚËÄÆ¬8253¼ÆÊýÆ÷0µÄ¼ÆÊýÖµ
 179   1              tl=C825340D;                                                                     //read 8253 16 bits data(first L then H )
 180   1              buf[25]=0xff-tl;
 181   1              th=C825340D;
 182   1              buf[26]=0xff-th;
 183   1              
 184   1              C82535C=0x84;                                //Ëø´æµÚÎåÆ¬8253¼ÆÊýÆ÷2µÄ¼ÆÊýÖµ
 185   1              tl=C825352D;                                                                     //read 8253 16 bits data(first L then H )
 186   1              buf[27]=0xff-tl;
 187   1              th=C825352D;
 188   1              buf[28]=0xff-th;
 189   1              
 190   1              C82535C=0x44;                                //Ëø´æµÚÎåÆ¬8253¼ÆÊýÆ÷1µÄ¼ÆÊýÖµ
 191   1              tl=C825351D;                                                                     //read 8253 16 bits data(first L then H )
 192   1              buf[29]=0xff-tl;
 193   1              th=C825351D;
 194   1              buf[30]=0xff-th;
 195   1              
 196   1              C82535C=0x04;                               //Ëø´æµÚÎåÆ¬8253¼ÆÊýÆ÷0µÄ¼ÆÊýÖµ
 197   1              tl=C825350D;                                                                     //read 8253 16 bits data(first L then H )
 198   1              buf[31]=0xff-tl;
 199   1              th=C825350D;
 200   1              buf[32]=0xff-th;
 201   1              
 202   1              buf[1]=Incinput;                                 //Ì½Í·¸öÊý
 203   1              buf[2]=Redrawtime;                               //²âÁ¿Ê±¼ä£¨Ë¢ÐÂÊ±¼ä±êÖ¾£©
 204   1              
 205   1      }
 206          /*******************************************
 207          *        8253¼ÆÊýÆ÷³õÊ¼»¯
 208          ********************************************/
 209           void Init_8253()
 210           {
 211   1          
 212   1      //=======×°Èë³õÖµÔÙ¿ªÊ¼¼ÆÊý=======//
 213   1              C82531C=0xb4;                               //10110100     
 214   1              C825312D=0xff;                                          //10£ºÍ¨µÀ2,11£ºÏÈµÍ×Ö½Úºó¸ß×Ö½Ú£¬010£º°´·½Ê½2¹¤×÷£¬0£º¶þ½øÖÆ¼ÆÊý¡£Ð´
             -³õÖµ0xffºó¿ªÊ¼¼ÆÊý
 215   1              C825312D=0xff;
 216   1              
 217   1              C82531C=0x74;                               //01110100     
 218   1              C825311D=0xff;                              //Í¬ÉÏ 
 219   1              C825311D=0xff;
 220   1              
 221   1              C82531C=0x34;                               //00110100     
 222   1              C825310D=0xff;                              //Ð´³õÖµ ÏÈµÍ×Ö½Úºó¸ß×Ö½Ú 82531Ð´³õÖµºó¾Í¿ªÊ¼¼ÆÊý 
 223   1              C825310D=0xff;                                                          //¶þÈýÐÐÓÃÀ´×°Èë³õÖµ
 224   1              
 225   1              C82532C=0xb4;                               //10110100     
 226   1              C825322D=0xff;                    
 227   1              C825322D=0xff;   
 228   1              
 229   1              C82532C=0x74;                               //01110100     
 230   1              C825321D=0xff;                    
 231   1              C825321D=0xff;
 232   1              
 233   1              C82532C=0x34;                               //00110100     
 234   1              C825320D=0xff;                    
 235   1              C825320D=0xff;
 236   1              
 237   1              C82533C=0xb4;                               //10110100     
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 5   

 238   1              C825332D=0xff;                    
 239   1              C825332D=0xff;                             
 240   1              
 241   1              C82533C=0x74;                               //01110100     
 242   1              C825331D=0xff;                    
 243   1              C825331D=0xff;
 244   1              
 245   1              C82533C=0x34;                               //00110100     
 246   1              C825330D=0xff;                    
 247   1              C825330D=0xff;
 248   1              
 249   1              C82534C=0xb4;                               //10110100     
 250   1              C825342D=0xff;                    
 251   1              C825342D=0xff;    
 252   1              
 253   1              C82534C=0x74;                               //01110100     
 254   1              C825341D=0xff;                    
 255   1              C825341D=0xff;
 256   1              
 257   1              C82534C=0x34;                               //00110100     
 258   1              C825340D=0xff;                    
 259   1              C825340D=0xff;
 260   1              
 261   1              C82535C=0xb4;                               //10110100     
 262   1              C825352D=0xff;                    
 263   1              C825352D=0xff; 
 264   1              
 265   1              C82535C=0x74;                               //01110100     
 266   1              C825351D=0xff;                    
 267   1              C825351D=0xff;
 268   1              
 269   1              C82535C=0x34;                               //00110100     
 270   1              C825350D=0xff;                    
 271   1              C825350D=0xff;  
 272   1          
 273   1              Var_Led=0xff;                               //ledÖ¸Ê¾
 274   1              Led573=Var_Led;
 275   1              EX0=0;                                      //¹ØÍâ²¿ÖÐ¶Ï0
 276   1       /*¶¨Ê±¼ÆÊýÆ÷µÄ³õÊ¼»¯*/
 277   1          GATE=1;                                     //8253¿ªÆô¼ÆÊý
 278   1          Flag8253Cnting = 1;
 279   1              NumT0 = 0;
 280   1        }   
 281          
 282          
 283          /************************************
 284          *           ÏÔÊ¾¼ÆÊý
 285          ************************************/
 286          void ShowData()
 287          {
 288   1              uchar m,j,Var1;//,i     
 289   1              //uchar ii=2; 
 290   1              uchar u;                                                                                        //15Äê10ÔÂ20ÈÕ¼Ó
 291   1          ulong count_temp,jishuguan_count_temp,dianlishi_count_temp;
 292   1              float idata ptemp,rata,Drata,yudecide,zdata,jishuguan_rata,jishuguan_jtemp,dianlishi_jtemp;     //15Äê10ÔÂ20È
             -ÕÐÞ¸Ä
 293   1              float Gjtemp[8];                                                                        //15Äê10ÔÂ20ÈÕÐÞ¸Ä
 294   1              float Djtemp[8];                                                                        //15Äê10ÔÂ20ÈÕÐÞ¸Ä
 295   1              double yu,yudata,mtemp;
 296   1              uchar Tbcd[12];                                                                         //²âµÃµÄÊý¾ÝµÄbcdÂëÊý×é
 297   1          Lcd_Clear();
 298   1      if(measure_flag)                                                                                //(1)measure_flagÔÚInit_RAMÖÐ³õÊ¼»¯±äÎª1
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 6   

 299   1      {       
 300   2              for(u=0;u<8;u++)
 301   2              {
 302   3                      Gjtemp[j]=0;
 303   3                      Djtemp[j]=0;
 304   3                      GFlag_dw[j]=0;                      //GM¼ÆÊý¹Üµ¥Î»±êÖ¾
 305   3                      DFlag_dw[j]=0;
 306   3                      Ddata[j]=0;                                                                             //(2015Äê10ÔÂ20ÈÕ¼Ó)
 307   3                      Tdata[j]=0;                                        //Ì½Í·¼ÆÊýÂÊuint,×ÏÉ«ÎªÈ«¾Ö±äÁ¿£¬À¶É«Îª¾Ö²¿±äÁ¿
 308   3              }
 309   2              for(j=0;j<Incinput;j++)                             //(2)´æ¼ÆÊýÇøÎªbuf[3]-buf[32];Ì½Í·¸öÊý±êÖ¾
 310   2              {
 311   3                      zdata=0;                                                                                //float¼ÆÊý¹Ü
 312   3                      rata=0;                                                                                 //float¼ÆÊý¹Ü¼ÆÊýÂÊ
 313   3                      Drata=0;                                                                                //floatµçÀëÊÒ¼ÆÊýÂÊ(2015Äê10ÔÂ20ÈÕ¼Ó)
 314   3              ptemp=0;                                                                                //float
 315   3              yudata=0;                                                                               //double
 316   3                      mtemp=0;                                                                                //double
 317   3                      yu=0;                                                                                   //double
 318   3                      m=j*10;                           //±£Áô
 319   3                      //i=jishu%(Incinput*3);
 320   3                      //isave=count%(Incinput*2);
 321   3             /*********ÅÐ¶Ï¼ÆÊýÂÊ***********/
 322   3                 /*********Ç°Æß¸öÌ½Í·Ì½²âÆ÷ÉèÖÃ£¬È¡µÃ8253¼ÆÊýÖµ¼ÇÂ¼ÔÚTdata*/
 323   3             if(j<7)                                                                                  //(3)Ç°Æß¸öÌ½Í·¼ÈÓÐµçÀëÊÒÒ²ÓÐ¼ÆÊýÆ÷£¬µÚ°Ë¸öÖ»ÓÐµçÀëÊÒ¹Ê·Ö¿ª´¦Àí
 324   3                      {
 325   4                              Var1=(Var_Signal1 & Svar1[j]);              //(4)Ì½Í·¿ØÖÆÐÅºÅ1,var-signalÌ½Í·¿ØÖÆ±êÖ¾(È«½Ó¼ÆÊý¹Ü)£»Svar
             -1[8]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80}
 326   4                              if(Var1 == Svar1[j])                                            //ÒâË¼ÊÇµ±JºÅÌ½Í·Îª¼ÆÊý¹ÜÊ±
 327   4                              {
 328   5                                      
 329   5                                      Tdata[j] = buf[4*j+4]*256+buf[4*j+3];           //bufÎªËø´æµÄ8253¼ÆÊýÆ÷¸ß°ËÎ»µÍ°ËÎ»£¬¹²16Î»(µ±Ç°±êºÅÌ½²âÆ÷¼ÆÊ
             -ý¹ÜµÄ¼ÆÊý)
 330   5                                      Ddata[j] = buf[4*j+6]*256+buf[4*j+5];           //µçÀëÊÒ¼ÆÊý(2015Äê10ÔÂ20ÈÕ¼Ó)
 331   5                                      //compare[i]=Tdata;
 332   5                                      //if((compare[j]==compare[j+Incinput])&&(compare[j+Incinput]==compare[j+Incinput*2])&&(compare[j+Inci
             -nput*2]==compare[j]))
 333   5                                      //Tdata=0;
 334   5                                      
 335   5                              }
 336   4                              else if(Var1 == 0)                                                      //(4)
 337   4                              {
 338   5                                       Ddata[j] = buf[4*j+6]*256+buf[4*j+5];          //µçÀëÊÒ¼ÆÊý(2015Äê10ÔÂ20ÈÕ¸Ä)
 339   5                                       Tdata[j] = buf[4*j+4]*256+buf[4*j+3];          //¼ÆÊý¹Ü¼ÆÊý(2015Äê10ÔÂ20ÈÕ¼Ó)
 340   5                                       //compare[i]=Tdata;
 341   5                                       //if((compare[j]==compare[j+Incinput])&&(compare[j+Incinput]==compare[j+Incinput*2])&&(compare[j+Inc
             -input*2]==compare[j]))
 342   5                                   // Tdata=0;
 343   5                                              Var_Signal1 = Var_Signal1 & Svar0[j];   //Svar0[8]={0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F}
 344   5                              }
 345   4                              /*Í¨¹ýË¢ÐÂÊ±¼ä±êÖ¾RedrawtimeºÍ´Ó8253²É¼¯À´µÄ¼ÆÊýÖµTdata¼ÆËãÌ½²âÆ÷¼ÆÊýÂÊ,²¢ÇÒGM¼ÆÊý¹ÜÓëµçÀëÊÒ¼ÆËã¼ÆÊýÂÊ·
             -½·¨²»Í¬*/
 346   4                              if(count_change_flag[j]==0)                                     //(4)¼ÆÊý¸Ä±ä±êÖ¾£¬³õÊ¼»¯count_change_flag¾ùÎª0,Èôµ±Ç°¼ÁÁ¿ÖµÓÃGM¼ÆÊý¹Ü×
             -÷ÎªÊä³öÊ±Îª0
 347   4                              {
 348   5                                      if(Redrawtime >= 60)                                        //(5)ÐÞ¸Ä2012.6.15 £¬ÒòÎªÐ¡ÓÚ60ÃëÓë´óÓÚ60sµÄ¼ÆËã·½·¨²»Í¬£¬RedrawtimeË¢ÐÂÊ
             -±¼ä±êÖ¾
 349   5                                      {
 350   6                                              zdata = Redrawtime/60;                  
 351   6                              rata = Tdata[j]/zdata;                                  //¼ÆÊý¹ÜµÄ¼ÆÊýÂÊ                                        
 352   6                              Drata = Ddata[j]/zdata;                                 //µçÀëÊÒµÄ¼ÆÊýÂÊ(2015Äê10ÔÂ20ÈÕ¼Ó)
 353   6                                      }                                                                                
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 7   

 354   5                                      else if (Redrawtime < 60 )                                 //ÐÞ¸Ä2012.6.15 £¬ÒòÎªÐ¡ÓÚ60ÃëÓë´óÓÚ60sµÄ¼ÆËã·½·¨²»Í¬
 355   5                                      {
 356   6                                              zdata =  600/Redrawtime;                  //ÐÞ¸Ä2012.7.1 £¬ÒòÎª60Ãë³ýÒÔ40,50ÃëÐ¡Êý£¬»á³öÏÖÎÊÌâ
 357   6                              rata =Tdata[j]*zdata/10;                                  //ÐÞ¸Ä2012.7.1                                        
 358   6                                              Drata =Ddata[j]*zdata/10;                                       //µçÀëÊÒ(2015Äê10ÔÂ20ÈÕ¼Ó)
 359   6                                      }
 360   5                              }
 361   4                              else if(count_change_flag[j]==1)                                //ÔÚDose_Rata´óÓÚ1000Ê±Count_Change_flagÖÃ1,¼´µ±µ±Ç°¼ÁÁ¿ÖµÓÃµçÀëÊÒÎ
             -ªÊä³öÊ±Îª1
 362   4                              {
 363   5                                      
 364   5                                       rata=Tdata[j]*1.67;                                                    //ÒòÎª´ËÊ±Ñ¡ÓÃµçÀëÊÒ×÷ÎªÊä³ö,µçÀëÊÒµÄË¢ÐÂÊ±¼ä±êÖ¾Redrawtime±äÎªÁË3;
 365   5                                       Drata=Ddata[j]*1.67;
 366   5                              }
 367   4                              /*ÅÐ¶ÏDoseRataÖµ´óÐ¡½øÐÐÁ¿³Ì²ÎÊýµÄÇÐ»»£¬Í¨¹ý¹«Ê½£¬Ì½²âÆ÷±ê¶¨µÄ²ÎÊý(Para[])ºÍ
 368   4                              rata(¾ÍÊÇNcÊµ¼ÊµÄ¼ÆÊýÂÊ)¼ÆËã¼ÁÁ¿ÂÊDoseRata£¨¹æ¶¨Æäµ¥Î»ÎªuGy/h£©*/
 369   4                              if(DoseRata[j] < 0.15)                // ÐÞ¸Ä2012.6.15 && (DoseRata[j] >= 0)
 370   4                              {
 371   5                                   Para[0] = (float)(DataThouth[m+1]*1000+DataCent[m+1]*100+DataTenth[m+1]*10+DataGe[m+1]); //µ÷½Ú²ÎÊ
             -ý
 372   5                                   Para[1] = (float)((float)(DataThouth[m+2]*1000+DataCent[m+2]*100+DataTenth[m+2]*10+DataGe[m+2])/10
             -00000);
 373   5                                       Para[4] = (float)(DataThouth[m+5]*1000+DataCent[m+5]*100+DataTenth[m+5]*10+DataGe[m+5]); //µ÷½Ú²ÎÊý
 374   5                       Para[5] = (float)((float)(DataThouth[m+6]*1000+DataCent[m+6]*100+DataTenth[m+6]*10+DataGe
             -[m+6])/1000);
 375   5                                   GDoseRata[j] = (float)(Para[1]*(rata-Para[0]));
 376   5                                       DDoseRata[j] = (float)(Para[5]*(Drata-Para[4]));
 377   5                                       DoseRata[j]=GDoseRata[j];
 378   5                                       TrueRate[j]=1;
 379   5                                       if(GDoseRata[j]<0)
 380   5                                               GDoseRata[j]=0.0;
 381   5                                       if(DDoseRata[j]<0)
 382   5                                               DDoseRata[j]=0.0;
 383   5                                   Var_Signal1 = Var_Signal1 | Svar1[j];                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµçÆ½
 384   5                                   Var_Signal2 = Var_Signal2 & Svar0[j];                                              //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10(8),µÍµçÆ½
 385   5                                   Var_Signal3 = Var_Signal3 & Svar0[j];                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10(6),µÍµçÆ½
 386   5                                       count_change_flag[j]=0;
 387   5                              }       
 388   4                              else if((DoseRata[j] >= 0.15) && (DoseRata[j] < 1000))             //µ±¼ÁÁ¿ÂÊ³¬¹ý0.15uGy/hÊ±£¬Ê¹ÓÃ¼ÆÊý¹
             -ÜµÄµÚ¶þ×é²ÎÊý
 389   4                              {    
 390   5                                   Para[2] = (float)(DataThouth[m+3]*1000+DataCent[m+3]*100+DataTenth[m+3]*10+DataGe[m+3]); //µ÷½Ú²ÎÊ
             -ý
 391   5                                   Para[3] = (float)((float)(DataThouth[m+4]*1000+DataCent[m+4]*100+DataTenth[m+4]*10+DataGe[m+4])/10
             -00000);
 392   5                                       Para[4] = (float)(DataThouth[m+5]*1000+DataCent[m+5]*100+DataTenth[m+5]*10+DataGe[m+5]); //µ÷½Ú²ÎÊý
 393   5                       Para[5] = (float)((float)(DataThouth[m+6]*1000+DataCent[m+6]*100+DataTenth[m+6]*10+DataGe
             -[m+6])/1000);
 394   5                                   GDoseRata[j] = (float)(Para[3]*(rata-Para[2])); 
 395   5                                       DDoseRata[j] = (float)(Para[5]*(Drata-Para[4]));
 396   5                                       DoseRata[j]=GDoseRata[j];
 397   5                                       TrueRate[j]=1;
 398   5                                       if(GDoseRata[j]<0)
 399   5                                               GDoseRata[j]=0.0;
 400   5                                       if(DDoseRata[j]<0)
 401   5                                               DDoseRata[j]=0.0;
 402   5                                   Var_Signal1 = Var_Signal1 | Svar1[j];                   //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµçÆ½
 403   5                                   Var_Signal2 = Var_Signal2 & Svar0[j];                   //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10(8),µÍµçÆ½
 404   5                                   Var_Signal3 = Var_Signal3 & Svar0[j];                   //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10(6),µÍµçÆ½
 405   5                                       count_change_flag[j]=0;
 406   5                              }
 407   4                          else if((DoseRata[j] >= 1000) && (DoseRata[j] < 500000))       //µ±¼ÁÁ¿ÂÊ³¬¹ý1mGy/hÊ±£¬Ê¹ÓÃµçÀëÊÒµÄµ
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 8   

             -ÚÒ»¸öÅ·Ä·µµ(10(10))
 408   4                          {
 409   5                                       Para[2] = (float)(DataThouth[m+3]*1000+DataCent[m+3]*100+DataTenth[m+3]*10+DataGe[m+3]); //µ÷½Ú²ÎÊý
 410   5                                       Para[3] = (float)((float)(DataThouth[m+4]*1000+DataCent[m+4]*100+DataTenth[m+4]*10+DataGe[m+4])/10000
             -00);
 411   5                                       Para[4] = (float)(DataThouth[m+5]*1000+DataCent[m+5]*100+DataTenth[m+5]*10+DataGe[m+5]); //µ÷½Ú²ÎÊý
 412   5                                       Para[5] = (float)((float)(DataThouth[m+6]*1000+DataCent[m+6]*100+DataTenth[m+6]*10+DataGe[m+6])/1000)
             -;
 413   5                                   GDoseRata[j] = (float)(Para[3]*(rata-Para[2])); 
 414   5                                       DDoseRata[j] = (float)(Para[5]*(Drata-Para[4]));
 415   5                                       DoseRata[j]=DDoseRata[j];
 416   5                                       TrueRate[j]=0;
 417   5                                   if(GDoseRata[j]<0)
 418   5                                               GDoseRata[j]=0.0;
 419   5                                       if(DDoseRata[j]<0)
 420   5                                               DDoseRata[j]=0.0;  
 421   5                                   Var_Signal1 = Var_Signal1 | Svar0[j];                    //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½,GM¼ÆÊý¹Ü¸ßÑ¹Ê
             -¼ÖÕÍ¨µç
 422   5                                   Var_Signal2 = Var_Signal2 & Svar0[j];                    //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10(8),µÍµçÆ½
 423   5                                   Var_Signal3 = Var_Signal3 & Svar0[j];                        //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10(6),µÍµçÆ½
 424   5                       count_change_flag[j]=1;
 425   5                                   Redrawtime = 3;
 426   5                              }
 427   4                          else if((DoseRata[j] >= 500000) && (DoseRata[j] < 1000000))   //µ±¼ÁÁ¿ÂÊ³¬¹ý500mGy/hÊ±£¬Ê¹ÓÃµçÀëÊÒµÄ
             -µÚÒ»¸öÅ·Ä·µµ(10(8)),ÓÐ´ý¾ßÌåÈ·¶¨
 428   4                  {   
 429   5                                       Para[2] = (float)(DataThouth[m+3]*1000+DataCent[m+3]*100+DataTenth[m+3]*10+DataGe[m+3]); //µ÷½Ú²ÎÊý
 430   5                                       Para[3] = (float)((float)(DataThouth[m+4]*1000+DataCent[m+4]*100+DataTenth[m+4]*10+DataGe[m+4])/10000
             -00);
 431   5                                   Para[6] = (float)(DataThouth[m+7]*1000+DataCent[m+7]*100+DataTenth[m+7]*10+DataGe[m+7]); //µ÷½Ú²ÎÊ
             -ý
 432   5                                   Para[7] = (float)((float)(DataThouth[m+8]*1000+DataCent[m+8]*100+DataTenth[m+8]*10+DataGe[m+8])/10
             -);
 433   5                       GDoseRata[j] = (float)(Para[3]*(rata-Para[2])); 
 434   5                                       DDoseRata[j] = (float)(Para[7]*(Drata-Para[6]));
 435   5                                       DoseRata[j]=DDoseRata[j];
 436   5                                       TrueRate[j]=0;
 437   5                                   if(GDoseRata[j]<0)
 438   5                                               GDoseRata[j]=0.0;
 439   5                                       if(DDoseRata[j]<0)
 440   5                                               DDoseRata[j]=0.0;  
 441   5                                   Var_Signal1 = Var_Signal1 | Svar0[j];                   //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 442   5                                   Var_Signal2 = Var_Signal2 | Svar1[j];                   //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10(8),¸ßµçÆ½
 443   5                                   Var_Signal3 = Var_Signal3 & Svar0[j];                   //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10(6),µÍµçÆ½
 444   5                                   count_change_flag[j]=1;
 445   5                                   Redrawtime = 3;
 446   5                              }
 447   4                          else if(DoseRata[j] >= 1000000)                              //µ±¼ÁÁ¿ÂÊ³¬¹ý1Gy/hÊ±£¬Ê¹ÓÃµçÀëÊÒµÄµÚÒ»
             -¸öÅ·Ä·µµ(10(6)),ÓÐ´ý¾ßÌåÈ·¶¨
 448   4                          {
 449   5                                       Para[2] = (float)(DataThouth[m+3]*1000+DataCent[m+3]*100+DataTenth[m+3]*10+DataGe[m+3]); //µ÷½Ú²ÎÊý
 450   5                                       Para[3] = (float)((float)(DataThouth[m+4]*1000+DataCent[m+4]*100+DataTenth[m+4]*10+DataGe[m+4])/10000
             -00);
 451   5                                       Para[8] = (float)(DataThouth[m+9]*1000+DataCent[m+9]*100+DataTenth[m+9]*10+DataGe[m+9]); //µ÷½Ú²ÎÊý
 452   5                                   Para[9] = (float)((float)((DataThouth[m+10]*1000+DataCent[m+10]*100+DataTenth[m+10]*10+DataGe[m+10
             -])*10));
 453   5                                   GDoseRata[j] = (float)(Para[3]*(rata-Para[2])); 
 454   5                                       DDoseRata[j] = (float)(Para[9]*(Drata-Para[8]));
 455   5                                       DoseRata[j]=DDoseRata[j];
 456   5                                       TrueRate[j]=0;
 457   5                                   if(GDoseRata[j]<0)
 458   5                                               GDoseRata[j]=0.0;
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 9   

 459   5                                       if(DDoseRata[j]<0)
 460   5                                               DDoseRata[j]=0.0; 
 461   5                                   Var_Signal1 = Var_Signal1 | Svar0[j];
 462   5                                   Var_Signal2 = Var_Signal2 & Svar0[j];
 463   5                                   Var_Signal3 = Var_Signal3 | Svar1[j];
 464   5                                   count_change_flag[j]=1;
 465   5                                   Redrawtime = 3;    
 466   5                         }
 467   4                              /******´ÓDoseRataÈ¡µÃ¼´Ê±ÖµÈý´ÎÆ½»¬È¡Æ½¾ùÖµ´æÈëMean_Value******/
 468   4                              if(Flag_Meant == 1)                                                                             //Ç°Îå´Î¼ÆÊýÖµ²»Òª,µÚÁù´ÎÒÔºóµÄ¼ÆÊýÖµ²ÅÒª,jishucount>4ºóFlag_Meant=1
 469   4                              {       
 470   5                                   //save[isave]=DoseRata[j];
 471   5                                      if(jishucount==5)
 472   5                                      {         
 473   6                                      GMean_Value[j]=GDoseRata[j];
 474   6                                              DMean_Value[j]=DDoseRata[j];
 475   6                                              Gsave0[j]=GDoseRata[j];
 476   6                                              Dsave0[j]=DDoseRata[j];
 477   6                                      }
 478   5                                      else if(jishucount==6)
 479   5                                      {
 480   6                                              GMean_Value[j]=(float)((Gsave0[j]+GDoseRata[j])/2);
 481   6                                              DMean_Value[j]=(float)((Dsave0[j]+DDoseRata[j])/2);
 482   6                                              Gsave1[j]=GDoseRata[j];
 483   6                                              Dsave1[j]=DDoseRata[j];
 484   6                                      }
 485   5                                      else if(jishucount==7)
 486   5                                      {   
 487   6                                          GMean_Value[j]= (float)((Gsave0[j]+Gsave1[j]+GDoseRata[j])/3);          //Æ½»¬Çó¾ùÖµ   add 2012.6.15
 488   6                                              DMean_Value[j]= (float)((Dsave0[j]+Dsave1[j]+DDoseRata[j])/3);
 489   6                                              Gsave2[j]=GDoseRata[j]; 
 490   6                                              Dsave2[j]=DDoseRata[j];
 491   6                                      }
 492   5                                      else if(jishucount>7)                                                    
 493   5                                      {
 494   6                                              Gsave0[j]=Gsave1[j];
 495   6                                              Gsave1[j]=Gsave2[j];
 496   6                                              Gsave2[j]=GDoseRata[j];
 497   6                                              GMean_Value[j]=(float)((Gsave0[j]+Gsave1[j]+GDoseRata[j])/3);
 498   6                                              Dsave0[j]=Dsave1[j];
 499   6                                              Dsave1[j]=Dsave2[j];
 500   6                                              Dsave2[j]=DDoseRata[j];
 501   6                                              DMean_Value[j]=(float)((Dsave0[j]+Dsave1[j]+DDoseRata[j])/3);
 502   6                                      }       
 503   5      
 504   5                      }
 505   4                               else if(Flag_Meant == 0)
 506   4                              {        
 507   5                                 GMean_Value[j] = GDoseRata[j];
 508   5                                 DMean_Value[j] = DDoseRata[j];
 509   5                              }       
 510   4              }                                                       //Ç°Æß¸öÓÐµçÀëÊÒÒ²ÓÐ¼ÆÊýÆ÷£¬ÇÒÓÐ¶à¸öÅ·Ä·µµ
 511   3                      else if(j == 7)                        //NIM_AµÄµÚ°Ë¸öÌ½Í·Ö»ÓÐ¸ßÑ¹µçÀëÊÒ£¬ÇÒÖ»ÓÐÒ»¸öÅ·Ä·µµ
 512   3              {
 513   4                              Ddata[j] = buf[32]*256 + buf[31];
 514   4                          //compare[i]=Tdata;
 515   4                              //if((compare[j]==compare[j+Incinput])&&(compare[j+Incinput]==compare[j+Incinput*2])&&(compare[j+Incinp
             -ut*2]==compare[j]))
 516   4                              // Tdata=0;
 517   4                              if(Redrawtime >= 60)                   //ÐÞ¸Ä2012.6.15 £¬ÒòÎªÐ¡ÓÚ60ÃëÓë´óÓÚ60sµÄ¼ÆËã·½·¨²»Í¬
 518   4                              {
 519   5                                      zdata = Redrawtime/60;
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 10  

 520   5                      Drata = Ddata[j]/zdata; 
 521   5                              }
 522   4                              else if (Redrawtime < 60)                  //ÐÞ¸Ä2012.6.15 £¬ÒòÎªÐ¡ÓÚ60ÃëÓë´óÓÚ60sµÄ¼ÆËã·½·¨²»Í¬
 523   4                              {
 524   5                                      zdata =  Ddata[j]*60;
 525   5                                      Drata = zdata/Redrawtime;
 526   5                              }       
 527   4                          if(DoseRata[j] < 1000000)                                 
 528   4                              {
 529   5                              Para[0] = (float)(DataThouth[m+1]*1000+DataCent[m+1]*100+DataTenth[m+1]*10+DataGe[m+1]); //µ÷½Ú²
             -ÎÊý
 530   5                                  Para[1] = (float)((float)(DataThouth[m+2]*1000+DataCent[m+2]*100+DataTenth[m+2]*10+DataGe[m+2])/100
             -0000);
 531   5                                  DDoseRata[j] = (float)(Para[1]*(Drata-Para[0]));
 532   5                                      DoseRata[j]=DDoseRata[j];
 533   5                                      TrueRate[j]=0;
 534   5                                      if(DDoseRata[j]<0)
 535   5                                              DDoseRata[j]=0.0;
 536   5                              Var_Signal3 = Var_Signal3 & Svar0[j];   
 537   5                  }
 538   4                          else if(DoseRata[j] >= 1000000)                                 
 539   4                              {
 540   5                                  Para[2] = (float)(DataThouth[m+3]*1000+DataCent[m+3]*100+DataTenth[m+3]*10+DataGe[m+3]); //µ÷½Ú²ÎÊý
 541   5                                  Para[3] = (float)((float)(DataThouth[m+4]*1000+DataCent[m+4]*100+DataTenth[m+4]*10+DataGe[m+4])/100
             -0000);
 542   5                                  DDoseRata[j] = (float)(Para[3]*(Drata-Para[2]));
 543   5                                      DoseRata[j]=DDoseRata[j];
 544   5                                      TrueRate[j]=0;
 545   5                                      if(DDoseRata[j]<0)
 546   5                                              DDoseRata[j]=0.0; 
 547   5                              Var_Signal3 = Var_Signal3 | Svar1[j];   
 548   5                                      Redrawtime = 3;          
 549   5                              }
 550   4                                     
 551   4                              if(Flag_Meant == 1) 
 552   4                              {       
 553   5                                  //save[isave]=DoseRata[j];
 554   5                                      if(jishucount==5)
 555   5                                      {         
 556   6                                      DMean_Value[j]=DDoseRata[j];
 557   6                                              Dsave0[j]=DDoseRata[j];
 558   6                                      }
 559   5                                      else if(jishucount==6)
 560   5                                      {
 561   6                                              DMean_Value[j]=(float)((DMean_Value[j]+DDoseRata[j])/2);
 562   6                                              Dsave1[j]=DDoseRata[j];
 563   6                                      }
 564   5                                      else if(jishucount==7)
 565   5                                      {   
 566   6                                              Dsave2[j]=DDoseRata[j]; 
 567   6                                          DMean_Value[j]= (float)((Dsave0[j]+Dsave1[j]+Dsave2[j])/3);     //Æ½»¬Çó¾ùÖµ   add 2012.6.15
 568   6                                      }
 569   5                                      else if(jishucount>7)                                                    
 570   5                                      {
 571   6                                              Dsave0[j]=Dsave1[j];
 572   6                                              Dsave1[j]=Dsave2[j];
 573   6                                              Dsave2[j]=DDoseRata[j];
 574   6                                              DMean_Value[j]=(float)((Dsave0[j]+Dsave1[j]+DDoseRata[j])/3);                                   
 575   6                                      }       
 576   5      
 577   5                      }
 578   4                              else if(Flag_Meant == 0)
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 11  

 579   4                              {        
 580   5                                      DMean_Value[j] = DDoseRata[j];
 581   5                              }       
 582   4                      }                                                       //µÚ°Ë¸öÌ½Í·Ö»ÓÐµçÀëÊÒ
 583   3                      /*½«¸ù¾Ý¼ÁÁ¿ÂÊÖµÖØÐÂÉèÖÃµÄÌ½Í·ÐÅºÅ¸Ä±ä±êÖ¾Ö´ÐÐ*/
 584   3                      Signal1 = Var_Signal1;                                        //Ì½Í·ÐÅºÅ×ª±ä
 585   3                      Signal2 = Var_Signal2;
 586   3                      Signal3 = Var_Signal3;
 587   3                      /**********µ¥Î»»»ËãºóÎªjtemp************/
 588   3                      if(GMean_Value[j] < 0)                                        //ÐÞ¸Ä2012.6.15 Í¨¹ý¾ùÖµ¼ÆËã
 589   3                      {
 590   4                          Gjtemp[j] = 0.0;
 591   4                      }
 592   3                      else if(GMean_Value[j] >= 0)                                                                            //Mean_ValueÆ½¾ùÖµµ¥Î»ÎªuGy/h
 593   3                      {
 594   4                              if(GMean_Value[j] < 1000)                                                                       //Mean_Value<1000±íÊ¾µ¥Î»ÎªuGy/h
 595   4                              {
 596   5                                  Gjtemp[j] = (float)GMean_Value[j];                                                  
 597   5                                      GFlag_dw[j] = 1;
 598   5                              }
 599   4                              else if((GMean_Value[j] >= 1000)&&(GMean_Value[j] < 1000000))   //1000<Mean_Value<1000000±íÊ¾mGy/h
 600   4                              {
 601   5                                  Gjtemp[j] = (float)(GMean_Value[j]/1000);
 602   5                                      GFlag_dw[j] = 2;
 603   5                              }
 604   4                          else if(GMean_Value[j] >= 1000000)                                                  //Mean_Value>=1000000±íÊ¾Gy/h
 605   4                              {
 606   5                                  Gjtemp[j] = (float)(GMean_Value[j]/1000000);
 607   5                                      GFlag_dw[j] = 3;                                        
 608   5                              }
 609   4                      }
 610   3                      if(DMean_Value[j] < 0)                                        //ÐÞ¸Ä2012.6.15 Í¨¹ý¾ùÖµ¼ÆËã
 611   3                      {
 612   4                          Djtemp[j] = 0.0;
 613   4                      }
 614   3                      else if(DMean_Value[j] >= 0)                                                                            //Mean_ValueÆ½¾ùÖµµ¥Î»ÎªuGy/h
 615   3                      {
 616   4                              if(DMean_Value[j] < 1000)                                                                       //Mean_Value<1000±íÊ¾µ¥Î»ÎªuGy/h
 617   4                              {
 618   5                                  Djtemp[j] = (float)DMean_Value[j];                                                  
 619   5                                      DFlag_dw[j] = 1;
 620   5                              }
 621   4                              else if((DMean_Value[j] >= 1000)&&(DMean_Value[j] < 1000000))   //1000<Mean_Value<1000000±íÊ¾mGy/h
 622   4                              {
 623   5                                  Djtemp[j] = (float)(DMean_Value[j]/1000);
 624   5                                      DFlag_dw[j] = 2;
 625   5                              }
 626   4                          else if(DMean_Value[j] >= 1000000)                                                  //Mean_Value>=1000000±íÊ¾Gy/h
 627   4                              {
 628   5                                  Djtemp[j] = (float)(DMean_Value[j]/1000000);
 629   5                                      DFlag_dw[j] = 3;                                        
 630   5                              }
 631   4                      }
 632   3              /***********ÅÐ¶ÏãÐÖµ************×¢ÒâÕâÀïµÄãÐÖµÑ¡ÔñÄÄÒ»¸öÌ½Í·µÄ¼ÆÁ¿Öµ×÷Îª±È½Ï?ÔÝÊ±ÏÈ±ê×¢µô*/
 633   3              mtemp=(YuThouth[j]+YuCent[j]*0.1+YuTenth[j]*0.01);          //ÔÝÊ±Ã»¸ù¾ÝÎ»ÊýÐÞ¸Ä;ãÐÖµ¼ÆËã»¹Ô­
 634   3                  yu=(double)(pow(10,YuGe[j]));
 635   3                  yudata=(double)(mtemp*yu);
 636   3                      yudecide=Gjtemp[j]*TrueRate[j]+Djtemp[j]*((1-TrueRate[j])/(1+TrueRate[j]));
 637   3                      if(yudecide >= yudata)                  //Èç¹û¼ÆÊý³¬¹ýÄ³Ò»¸ö·¶Î§£¬ÔòÉùÒô±¨¾¯
 638   3                       {  
 639   4                              if((Judge_Speak==0) ||(Speak_Alarm()==1))           //·äÃùÆ÷±¨¾¯£¬Speak_Alarm·µ»Ø1·äÃùÆ÷¹¤×÷
 640   4                              {
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 12  

 641   5                                       Flag_Warn=1;                                                                    //±¨¾¯±êÖ¾ÖÃÒ»
 642   5                              } 
 643   4                              Flag_need_Flash[j] = 1;                                                          //LEDÉÁË¸±êÖ¾ÖÃ1
 644   4                      State_Flash[j]=1;
 645   4                              Var_Led=Var_Led & Svar0[j];                             //LED±¨¾¯Ö¸Ê¾µÆ£¨char£©Svar0[8]={0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F
             -}
 646   4                       }
 647   3                      else if(yudecide < yudata)
 648   3                       {
 649   4                          Flag_need_Flash[j] = 0;
 650   4                      State_Flash[j]=0;
 651   4                  Var_Led=Var_Led | Svar1[j];
 652   4                       }
 653   3              }                       //forÑ­»·ÖÐ8¸öÌ½Í·¾ùÏÔÊ¾Ö´ÐÐÍê
 654   2              for(j=0;j<15;j++)                                                                       //ÏÔÊ¾Ñ­»·
 655   2              {
 656   3                      Tbcd[5]=0;                                                                              //ucharÊý×é¹²12Î»£¬²âµÃµÄÊý¾ÝµÄbcdÂëÊý×é
 657   3                      Tbcd[4]=0;
 658   3                      Tbcd[3]=0;
 659   3                      Tbcd[2]=0;
 660   3                      Tbcd[1]=0;
 661   3                      Tbcd[0]=0;
 662   3                      if(j<7)                                                                                 //Ç°Æß¸ö¼ÆÊý¹ÜµÄÏÔÊ¾
 663   3                      {
 664   4                               /***********¼ÁÁ¿ÂÊ×ª»»µ¥Î»ºó×ª»»³É¿ÉÒÔÏÔÊ¾µÄBCDÂë*************2015Äê10ÔÂ20ÈÕÔÝÊ±ÐÞ¸Ä,°ÑÏÔÊ¾Êý¾Ý×ª»»³ÌÐ
             -ò·ÅÔÚfor1->8Ñ­»·Ö®Íâ*/
 665   4                               if((Tbcd[5]<=9)&&(Tbcd[4]<=9)&&(Tbcd[3]<=9)&&(Tbcd[2]<=9)&&(Tbcd[1]<=9)&&(Tbcd[0]<=9))   //4.21  ËÆºõ¶
             -àÓà£¬¿É²»¿ÉÒÔÐÞ¸Äµô
 666   4                               {
 667   5                               Tbcd[5] =(uchar)(((int) Gjtemp[j])/100);           //°ÙÎ»                  
 668   5                               Tbcd[4] =(uchar)(((int) Gjtemp[j]) % 100 / 10);    //Ê®Î»
 669   5                               Tbcd[3] =(uchar)(((int) Gjtemp[j]) % 100 % 10);    //¸öÎ»
 670   5                               count_temp =(Gjtemp[j] - (int)Gjtemp[j])*1000;                 //¼ÆËãÐ¡ÓÚ1µÄ²¿·Ö£¬°ÑÐ¡Êý²¿·Ö±ä´ó£¬±£ÁôÈýÎ»Ð¡Êý
 671   5                               Tbcd[2] =(uchar)(count_temp/100);                              //Ð¡Ð¡ÊýÊ®·ÖÎ»
 672   5                               Tbcd[1] =(uchar)(count_temp%100/10);                   //Ð¡Êý°Ù·ÖÎ»
 673   5                               Tbcd[0] =(uchar)(count_temp%100%10);                   //Ð¡ÊýÇ§·ÖÎ»
 674   5                               //if(Flag_dw == 1)                                                             //¸ù¾ÝTbcd[]¼ÆËãyudecide(float)ÓÃÀ´ÅÐ¶Ï¼ÁÁ¿ÂÊÊÇ·ñ³¬¹ýãÐÖµ
 675   5                              //       yudecide=(float)(Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001);
 676   5                               //if(Flag_dw == 2)
 677   5                              //       yudecide=(float)((Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001)*1000);
 678   5                               //if(Flag_dw == 3)
 679   5                              //       yudecide=(float)((Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001)*1000000);
 680   5                               }      
 681   4                              /********¼ÁÁ¿ÂÊÏÔÊ¾**********/ 
 682   4                              Txtext(10,13+(j*58),"¼ÆÊý");                            //ÏÔÊ¾Ì½Í·
 683   4                              Tnumber(110,13+(j*58),j+1);                                     //ÏÔÊ¾Ì½Í·ºÅ
 684   4                              Txtext(140,13+(j*58),":");                                      //ÏÔÊ¾Ã°ºÅ
 685   4                              if(Tbcd[5] != 0)                                                        //Èô°ÙÎ»·ÇÁã£¬¸ù¾ÝÊýµÄ´óÐ¡À´ÏÔÊ¾
 686   4                              {
 687   5                                      Tnumber(180,13+(j*58),Tbcd[5]); 
 688   5                                      Tnumber(210,13+(j*58),Tbcd[4]);
 689   5                                      Tnumber(240,13+(j*58),Tbcd[3]);
 690   5                                      Txtext(270,13+(j*58),".");
 691   5                                      Tnumber(290,13+(j*58),Tbcd[2]);
 692   5                                      Tnumber(320,13+(j*58),Tbcd[1]);
 693   5                                      Tnumber(350,13+(j*58),Tbcd[0]);
 694   5                                      if(Tdata[j]<10)                                                 //ÓÃÓÚÏÔÊ¾TdataËø´æµÄ¼ÆÊýÖµÏÔÊ¾
 695   5                                              Tnumber(576,13+(j*58),Tdata[j]);             //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
 696   5                                      else if((Tdata[j]>=10)&&(Tdata[j]<100))
 697   5                                              Tnumber(556,13+(j*58),Tdata[j]);
 698   5                                      else if((Tdata[j]>=100)&&(Tdata[j]<1000))
 699   5                                              Tnumber(536,13+(j*58),Tdata[j]);
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 13  

 700   5                                      else if((Tdata[j]>=1000)&&(Tdata[j]<10000))
 701   5                                              Tnumber(516,13+(j*58),Tdata[j]);
 702   5                                      else if(Tdata[j]>=10000)
 703   5                                              Tnumber(496,13+(j*58),Tdata[j]);
 704   5                              }
 705   4                              else
 706   4                              {
 707   5                                      if(Tbcd[4] != 0)                                                //°ÙÎ»ÎªÁãÊ®Î»·ÇÁã
 708   5                                      {
 709   6                                              
 710   6                                              Tnumber(210,13+(j*58),Tbcd[4]);
 711   6                                              Tnumber(240,13+(j*58),Tbcd[3]);
 712   6                                              Txtext(270,13+(j*58),".");
 713   6                                              Tnumber(290,13+(j*58),Tbcd[2]);
 714   6                                              Tnumber(320,13+(j*58),Tbcd[1]);
 715   6                                              Tnumber(350,13+(j*58),Tbcd[0]);
 716   6                                              if(Tdata[j]<10)
 717   6                                                      Tnumber(576,13+(j*58),Tdata[j]);             //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
 718   6                                              else if((Tdata[j]>=10)&&(Tdata[j]<100))
 719   6                                                      Tnumber(556,13+(j*58),Tdata[j]);
 720   6                                              else if((Tdata[j]>=100)&&(Tdata[j]<1000))
 721   6                                                      Tnumber(536,13+(j*58),Tdata[j]);
 722   6                                              else if((Tdata[j]>=1000)&&(Tdata[j]<10000))
 723   6                                                      Tnumber(516,13+(j*58),Tdata[j]);
 724   6                                              else if(Tdata[j]>=10000)
 725   6                                                      Tnumber(496,13+(j*58),Tdata[j]);         //²âÊÔÍê³ÉºóÈ¥µô        2012.6.24
 726   6                                       }
 727   5                                       else                                                                   //°ÙÎ»Ê®Î»Î»¾ùÎªÁã£¬¸öÎ»·ÇÁã
 728   5                                       {
 729   6                                              Tnumber(240,13+(j*58),Tbcd[3]);
 730   6                                              Txtext(270,13+(j*58),".");                              //.Õ¼20¸öÏñËØ
 731   6                                              Tnumber(290,13+(j*58),Tbcd[2]);                 //Ò»¸öÊý×ÖÕ¼30¸öÏñËØ
 732   6                                              Tnumber(320,13+(j*58),Tbcd[1]);
 733   6                                              Tnumber(350,13+(j*58),Tbcd[0]);
 734   6                                              if(Tdata[j]<10)
 735   6                                                      Tnumber(576,13+(j*58),Tdata[j]);             //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
 736   6                                              else if((Tdata[j]>=10)&&(Tdata[j]<100))         //¿ÉÒÔ¿´¼ûÒ»¸öÊý×ÖÕ¼20ÏñËØ
 737   6                                                      Tnumber(556,13+(j*58),Tdata[j]);
 738   6                                              else if((Tdata[j]>=100)&&(Tdata[j]<1000))
 739   6                                                      Tnumber(536,13+(j*58),Tdata[j]);
 740   6                                              else if((Tdata[j]>=1000)&&(Tdata[j]<10000))
 741   6                                                      Tnumber(516,13+(j*58),Tdata[j]);
 742   6                                              else if(Tdata[j]>=10000)
 743   6                                                      Tnumber(496,13+(j*58),Tdata[j]);
 744   6                                              
 745   6                                       }
 746   5                              }         
 747   4                         /**********¼ÆÁ¿µ¥Î»ÏÔÊ¾***********/
 748   4                              if(GFlag_dw[j]==1)                                            //²âÊÔÍê³Éºó¼ÓÉÏ  2012.6.24
 749   4                              {   
 750   5                                      Txtext(390,13+(j*58),"uGy");
 751   5                              }
 752   4                              else  if(GFlag_dw[j]==2) 
 753   4                              {
 754   5                                      Txtext(390,13+(j*58),"mGy");
 755   5                              } 
 756   4                              else if(GFlag_dw[j]==3)
 757   4                              {
 758   5                                      Txtext(390,13+(j*58),"Gy");
 759   5                              }               
 760   4                              Alarm();                           //±¨¾¯
 761   4                              send_buf[8*j]=Tbcd[5];                          //ÏòNIM-B·¢ËÍÏÔÊ¾Êý¾Ý
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 14  

 762   4                              send_buf[8*j+1]=Tbcd[4];
 763   4                              send_buf[8*j+2]=Tbcd[3];
 764   4                              send_buf[8*j+3]=Tbcd[2];
 765   4                              send_buf[8*j+4]=Tbcd[1];
 766   4                              send_buf[8*j+5]=Tbcd[0];
 767   4                              send_buf[8*j+6]=Flag_dw;                        //·¢ËÍµ¥Î»±êÖ¾
 768   4                              send_buf[8*j+7]=Flag_need_Flash[j];     //LEDÉÁË¸±êÖ¾
 769   4                      }
 770   3                      else
 771   3                      {
 772   4                              shortdelay(5000);
 773   4                              Lcd_Clear();
 774   4                              Tbcd[5]=0;                                                                              //ucharÊý×é¹²12Î»£¬²âµÃµÄÊý¾ÝµÄbcdÂëÊý×é
 775   4                              Tbcd[4]=0;
 776   4                              Tbcd[3]=0;
 777   4                              Tbcd[2]=0;
 778   4                              Tbcd[1]=0;
 779   4                              Tbcd[0]=0;
 780   4                              /***********¼ÁÁ¿ÂÊ×ª»»µ¥Î»ºó×ª»»³É¿ÉÒÔÏÔÊ¾µÄBCDÂë*************2015Äê10ÔÂ20ÈÕÔÝÊ±ÐÞ¸Ä,°ÑÏÔÊ¾Êý¾Ý×ª»»³ÌÐò
             -·ÅÔÚfor1->8Ñ­»·Ö®Íâ*/
 781   4                               if((Tbcd[5]<=9)&&(Tbcd[4]<=9)&&(Tbcd[3]<=9)&&(Tbcd[2]<=9)&&(Tbcd[1]<=9)&&(Tbcd[0]<=9))   //4.21  ËÆºõ¶
             -àÓà£¬¿É²»¿ÉÒÔÐÞ¸Äµô
 782   4                               {
 783   5                               Tbcd[5] =(uchar)(((int) Djtemp[j-7])/100);           //°ÙÎ»                  
 784   5                               Tbcd[4] =(uchar)(((int) Djtemp[j-7]) % 100 / 10);    //Ê®Î»
 785   5                               Tbcd[3] =(uchar)(((int) Djtemp[j-7]) % 100 % 10);    //¸öÎ»
 786   5                               count_temp =(Djtemp[j-7] - (int)Djtemp[j-7])*1000;                     //¼ÆËãÐ¡ÓÚ1µÄ²¿·Ö£¬°ÑÐ¡Êý²¿·Ö±ä´ó£¬±£ÁôÈýÎ»Ð¡Êý
 787   5                               Tbcd[2] =(uchar)(count_temp/100);                              //Ð¡Ð¡ÊýÊ®·ÖÎ»
 788   5                               Tbcd[1] =(uchar)(count_temp%100/10);                   //Ð¡Êý°Ù·ÖÎ»
 789   5                               Tbcd[0] =(uchar)(count_temp%100%10);                   //Ð¡ÊýÇ§·ÖÎ»
 790   5                               //if(Flag_dw == 1)                                                             //¸ù¾ÝTbcd[]¼ÆËãyudecide(float)ÓÃÀ´ÅÐ¶Ï¼ÁÁ¿ÂÊÊÇ·ñ³¬¹ýãÐÖµ
 791   5                              //       yudecide=(float)(Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001);
 792   5                               //if(Flag_dw == 2)
 793   5                              //       yudecide=(float)((Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001)*1000);
 794   5                               //if(Flag_dw == 3)
 795   5                              //       yudecide=(float)((Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001)*1000000);
 796   5                               }      
 797   4                              /********¼ÁÁ¿ÂÊÏÔÊ¾**********/ 
 798   4                              Txtext(10,13+((j-7)*58),"¼ÆÊý");                                //ÏÔÊ¾Ì½Í·
 799   4                              Tnumber(110,13+((j-7)*58),(j-7)+1);                                     //ÏÔÊ¾Ì½Í·ºÅ
 800   4                              Txtext(140,13+((j-7)*58),":");                                  //ÏÔÊ¾Ã°ºÅ
 801   4                              if(Tbcd[5] != 0)                                                        //Èô°ÙÎ»·ÇÁã£¬¸ù¾ÝÊýµÄ´óÐ¡À´ÏÔÊ¾
 802   4                              {
 803   5                                      Tnumber(180,13+((j-7)*58),Tbcd[5]); 
 804   5                                      Tnumber(210,13+((j-7)*58),Tbcd[4]);
 805   5                                      Tnumber(240,13+((j-7)*58),Tbcd[3]);
 806   5                                      Txtext(270,13+((j-7)*58),".");
 807   5                                      Tnumber(290,13+((j-7)*58),Tbcd[2]);
 808   5                                      Tnumber(320,13+((j-7)*58),Tbcd[1]);
 809   5                                      Tnumber(350,13+((j-7)*58),Tbcd[0]);
 810   5                                      if(Ddata[j-7]<10)                                                       //ÓÃÓÚÏÔÊ¾TdataËø´æµÄ¼ÆÊýÖµÏÔÊ¾
 811   5                                              Tnumber(576,13+((j-7)*58),Ddata[j-7]);       //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
 812   5                                      else if((Ddata[j-7]>=10)&&(Ddata[j-7]<100))
 813   5                                              Tnumber(556,13+((j-7)*58),Ddata[j-7]);
 814   5                                      else if((Ddata[j-7]>=100)&&(Ddata[j-7]<1000))
 815   5                                              Tnumber(536,13+((j-7)*58),Ddata[j-7]);
 816   5                                      else if((Ddata[j-7]>=1000)&&(Ddata[j-7]<10000))
 817   5                                              Tnumber(516,13+((j-7)*58),Ddata[j-7]);
 818   5                                      else if(Ddata[j-7]>=10000)
 819   5                                              Tnumber(496,13+((j-7)*58),Ddata[j-7]);
 820   5                              }
 821   4                              else
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 15  

 822   4                              {
 823   5                                      if(Tbcd[4] != 0)                                                //°ÙÎ»ÎªÁãÊ®Î»·ÇÁã
 824   5                                      {
 825   6                                              
 826   6                                              Tnumber(210,13+((j-7)*58),Tbcd[4]);
 827   6                                              Tnumber(240,13+((j-7)*58),Tbcd[3]);
 828   6                                              Txtext(270,13+((j-7)*58),".");
 829   6                                              Tnumber(290,13+((j-7)*58),Tbcd[2]);
 830   6                                              Tnumber(320,13+((j-7)*58),Tbcd[1]);
 831   6                                              Tnumber(350,13+((j-7)*58),Tbcd[0]);
 832   6                                              if(Ddata[j-7]<10)
 833   6                                                      Tnumber(576,13+((j-7)*58),Ddata[j-7]);       //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
 834   6                                              else if((Ddata[j-7]>=10)&&(Ddata[j-7]<100))
 835   6                                                      Tnumber(556,13+((j-7)*58),Ddata[j-7]);
 836   6                                              else if((Ddata[j-7]>=100)&&(Ddata[j-7]<1000))
 837   6                                                      Tnumber(536,13+((j-7)*58),Ddata[j-7]);
 838   6                                              else if((Ddata[j-7]>=1000)&&(Ddata[j-7]<10000))
 839   6                                                      Tnumber(516,13+((j-7)*58),Ddata[j-7]);
 840   6                                              else if(Ddata[j-7]>=10000)
 841   6                                                      Tnumber(496,13+((j-7)*58),Ddata[j-7]);   //²âÊÔÍê³ÉºóÈ¥µô        2012.6.24
 842   6                                       }
 843   5                                       else                                                                   //°ÙÎ»Ê®Î»Î»¾ùÎªÁã£¬¸öÎ»·ÇÁã
 844   5                                       {
 845   6                                              Tnumber(240,13+((j-7)*58),Tbcd[3]);
 846   6                                              Txtext(270,13+((j-7)*58),".");                          //.Õ¼20¸öÏñËØ
 847   6                                              Tnumber(290,13+((j-7)*58),Tbcd[2]);                     //Ò»¸öÊý×ÖÕ¼30¸öÏñËØ
 848   6                                              Tnumber(320,13+((j-7)*58),Tbcd[1]);
 849   6                                              Tnumber(350,13+((j-7)*58),Tbcd[0]);
 850   6                                              if(Ddata[j-7]<10)
 851   6                                                      Tnumber(576,13+((j-7)*58),Ddata[j-7]);       //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
 852   6                                              else if((Ddata[j-7]>=10)&&(Ddata[j-7]<100))             //¿ÉÒÔ¿´¼ûÒ»¸öÊý×ÖÕ¼20ÏñËØ
 853   6                                                      Tnumber(556,13+((j-7)*58),Ddata[j-7]);
 854   6                                              else if((Ddata[j-7]>=100)&&(Ddata[j-7]<1000))
 855   6                                                      Tnumber(536,13+((j-7)*58),Ddata[j-7]);
 856   6                                              else if((Ddata[j-7]>=1000)&&(Ddata[j-7]<10000))
 857   6                                                      Tnumber(516,13+((j-7)*58),Ddata[j-7]);
 858   6                                              else if(Ddata[j-7]>=10000)
 859   6                                                      Tnumber(496,13+((j-7)*58),Ddata[j-7]);
 860   6                                              
 861   6                                       }
 862   5                              }         
 863   4                         /**********¼ÆÁ¿µ¥Î»ÏÔÊ¾***********/
 864   4                              if(DFlag_dw[j-7]==1)                                          //²âÊÔÍê³Éºó¼ÓÉÏ  2012.6.24
 865   4                              {   
 866   5                                      Txtext(390,13+((j-7)*58),"uGy");
 867   5                              }
 868   4                              else  if(DFlag_dw[j-7]==2) 
 869   4                              {
 870   5                                      Txtext(390,13+((j-7)*58),"mGy");
 871   5                              } 
 872   4                              else if(DFlag_dw[j-7]==3)
 873   4                              {
 874   5                                      Txtext(390,13+((j-7)*58),"Gy");
 875   5                              }               
 876   4                              Alarm();                           //±¨¾¯
 877   4                              send_buf[8*j]=Tbcd[5];                          //ÏòNIM-B·¢ËÍÏÔÊ¾Êý¾Ý
 878   4                              send_buf[8*j+1]=Tbcd[4];
 879   4                              send_buf[8*j+2]=Tbcd[3];
 880   4                              send_buf[8*j+3]=Tbcd[2];
 881   4                              send_buf[8*j+4]=Tbcd[1];
 882   4                              send_buf[8*j+5]=Tbcd[0];
 883   4                              send_buf[8*j+6]=Flag_dw;                        //·¢ËÍµ¥Î»±êÖ¾
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 16  

 884   4                              send_buf[8*j+7]=Flag_need_Flash[j];     //LEDÉÁË¸±êÖ¾
 885   4                      }
 886   3                Flag_Warn_Count=1;
 887   3                jishucount++;                                                 //¼ÆÊý´ÎÊýÔö¼Ó£¨ËãÆ½¾ùÖµÊ±ÓÃ£©
 888   3                if(jishucount==255)                                   //¼ÆÊý´ÎÊýÒòÎªÊÇcharÐÍ±äÁ¿£¬×î¶àÖ§³Ö255¸ö£¬ËùÒÔÒªÖÃÁã
 889   3                    jishucount=8;
 890   3                if(jishucount>4)                                              
 891   3                    Flag_Meant = 1;//Ç°Îå´ÎµÄÈ¡Öµ²»Òª£¬µÚÎå´Î²Å¿ªÊ¼Òª£¬ÖÃFlag_Meant=1£»·ñÔò¾ùÖÃ0
 892   3                else
 893   3                    Flag_Meant = 0;
 894   3                shortdelay(5000);                                             //ÑÓÊ±
 895   3                //for(i=0;i<33;i++)   //ÏÔÊ¾ÍêÇå0
 896   3                     //buf[i]=0;
 897   3      }                                               //²âÁ¿±êÖ¾
 898   2      else
*** ERROR C141 IN LINE 898 OF 8253COUNT.C: syntax error near 'else'
 899   2      {
 900   3              jishuguan_data=0;                   //need think  whether need?  4.21,int¼ÆÊý¹ÜÊý¾Ý£¬
 901   3                      dianlishi_data=0;                                       //µçÀëÊÒÊý¾Ý
 902   3                      jishuguan_rata=0;                                       //¼ÆÊý¹Ü¼ÆÊýÂÊ
 903   3                      jishuguan_jtemp=0;                                      //¼ÆÊý¹Ü¼ÁÁ¿Öµ(µ¥Î»×ª»»ºó)
 904   3                      dianlishi_jtemp=0;                                      //µçÀëÊÒ¼ÁÁ¿Öµ£¨µ¥Î»×ª»»ºó£©
 905   3                      Tbcd[11]=0;
 906   3                      Tbcd[10]=0;
 907   3                      Tbcd[9]=0;
 908   3                      Tbcd[8]=0;
 909   3                      Tbcd[7]=0;
 910   3                      Tbcd[6]=0;
 911   3                      Tbcd[5]=0;
 912   3                      Tbcd[4]=0;
 913   3                      Tbcd[3]=0;
 914   3                      Tbcd[2]=0;
 915   3                      Tbcd[1]=0;
 916   3                      Tbcd[0]=0;
 917   3                      j=10*biaoding_input-7;                                          //biaodin_inputÎªÒª±ê¶¨µÄÌ½Í·ÐòºÅ
 918   3                      jishuguan_data = buf[4*biaoding_input]*256+buf[4*biaoding_input-1];             //Ïàµ±ÓÚTdata
 919   3                      jishuguan_rata=jishuguan_data*12;                                                                               //¼ÆÊýÂÊ£¬Ö±½Ó³ËÒÔ12?
 920   3                      dianlishi_data = buf[4*biaoding_input+1]*256+buf[4*biaoding_input+2];   //µçÀëÊÒTdata
 921   3                      Para[0] = (float)(DataThouth[j]*1000+DataCent[j]*100+DataTenth[j]*10+DataGe[j]); //µ÷½Ú²ÎÊý
*** ERROR C215 IN LINE 921 OF 8253COUNT.C: illegal type conversion
 922   3                  Para[1] = (float)((float)(DataThouth[j+1]*1000+DataCent[j+1]*100+DataTenth[j+1]*10+DataGe[j+1])/10000
             -00);
*** ERROR C215 IN LINE 922 OF 8253COUNT.C: illegal type conversion
 923   3                  jishuguan_DoseRata = (float)(Para[1]*(jishuguan_rata-Para[0])); 
*** ERROR C215 IN LINE 923 OF 8253COUNT.C: illegal type conversion
 924   3                      if(jishuguan_DoseRata<0)
 925   3                              jishuguan_DoseRata=0.0;
 926   3                      jishuguan_jtemp = (float)jishuguan_DoseRata;
 927   3                      if((Tbcd[11]<=9)&&(Tbcd[10]<=9)&&(Tbcd[9]<=9)&&(Tbcd[8]<=9)&&(Tbcd[7]<=9)&&(Tbcd[6]<=9))   //4.21  ËÆºõ¶
             -àÓà£¬¿É²»¿ÉÒÔÐÞ¸Äµô
 928   3                      {
 929   4                          
 930   4                              Tbcd[11] =(uchar)(((int) jishuguan_jtemp)/100);           //Ç§Î»                  
 931   4                              Tbcd[10] =(uchar)(((int) jishuguan_jtemp) % 100 / 10);    //°ÙÎ»
 932   4                              Tbcd[9] =(uchar)(((int) jishuguan_jtemp) % 100 % 10);    //¸öÎ»
 933   4                              jishuguan_count_temp =(jishuguan_jtemp - (int)jishuguan_jtemp)*1000;
 934   4                              Tbcd[8] =(uchar)(jishuguan_count_temp/100);
 935   4                              Tbcd[7] =(uchar)(jishuguan_count_temp%100/10);
 936   4                              Tbcd[6] =(uchar)(jishuguan_count_temp%100%10);
 937   4                      }
 938   3                      Para[2] = (float)(DataThouth[j+2]*1000+DataCent[j+2]*100+DataTenth[j+2]*10+DataGe[j+2]); //µ÷½Ú²ÎÊý
*** ERROR C215 IN LINE 938 OF 8253COUNT.C: illegal type conversion
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 17  

 939   3                  Para[3] = (float)((float)(DataThouth[j+3]*1000+DataCent[j+3]*100+DataTenth[j+3]*10+DataGe[j+3])/1000)
             -;
*** ERROR C215 IN LINE 939 OF 8253COUNT.C: illegal type conversion
 940   3                      dianlishi_DoseRata = (float)(Para[3]*(dianlishi_data-Para[2]));
*** ERROR C215 IN LINE 940 OF 8253COUNT.C: illegal type conversion
 941   3                      if(dianlishi_DoseRata<0)
 942   3                              dianlishi_DoseRata=0.0;
 943   3                      dianlishi_jtemp = (float)(dianlishi_DoseRata/1000);
 944   3                      if((Tbcd[5]<=9)&&(Tbcd[4]<=9)&&(Tbcd[3]<=9)&&(Tbcd[2]<=9)&&(Tbcd[1]<=9)&&(Tbcd[0]<=9))   //4.21  ËÆºõ¶àÓ
             -à£¬¿É²»¿ÉÒÔÐÞ¸Äµô
 945   3                      {
 946   4                          
 947   4                              Tbcd[5] =(uchar)(((int) dianlishi_jtemp)/100);           //Ç§Î»                  
 948   4                              Tbcd[4] =(uchar)(((int) dianlishi_jtemp) % 100 / 10);    //°ÙÎ»
 949   4                              Tbcd[3] =(uchar)(((int) dianlishi_jtemp) % 100 % 10);    //¸öÎ»
 950   4                              dianlishi_count_temp =(dianlishi_jtemp - (int)dianlishi_jtemp)*1000;
 951   4                              Tbcd[2] =(uchar)(dianlishi_count_temp/100);
 952   4                              Tbcd[1] =(uchar)(dianlishi_count_temp%100/10);
 953   4                              Tbcd[0] =(uchar)(dianlishi_count_temp%100%10);
 954   4                      }
 955   3                      Txtext(200,58,"±ê¶¨Ì½Í·");
 956   3                      Tnumber(400,58,biaoding_input);
 957   3                      Txtext(10,116,"¸Ç¸ï¹Ü");;
 958   3                      Txtext(160,116,":");
 959   3                      Txtext(220,174,"uGy/h");
 960   3                      Txtext(520,174,"CPM");
 961   3                      Txtext(10,290,"µçÀëÊÒ");;
 962   3                      Txtext(160,290,":");
 963   3                      Txtext(220,348,"mGy/h");
 964   3                      Txtext(520,348,"CP5S");
 965   3                      if(Tbcd[11] != 0)
 966   3                      {
 967   4                              Tnumber(10,174,Tbcd[11]); 
 968   4                              Tnumber(40,174,Tbcd[10]);
 969   4                  Tnumber(70,174,Tbcd[9]);
 970   4                      Txtext(100,174,".");
 971   4                      Tnumber(130,174,Tbcd[8]);
 972   4                          Tnumber(160,174,Tbcd[7]);
 973   4                              Tnumber(190,174,Tbcd[6]);
 974   4                              if(jishuguan_data<10)
 975   4                                      Tnumber(490,174,jishuguan_data);             //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
 976   4                              else if((jishuguan_data>=10)&&(jishuguan_data<100))
 977   4                                      Tnumber(460,174,jishuguan_data);
 978   4                              else if((jishuguan_data>=100)&&(jishuguan_data<1000))
 979   4                                      Tnumber(430,174,jishuguan_data);
 980   4                              else if((jishuguan_data>=1000)&&(jishuguan_data<10000))
 981   4                                      Tnumber(400,174,jishuguan_data);
 982   4                              else if(jishuguan_data>=10000)
 983   4                                      Tnumber(370,174,jishuguan_data);
 984   4                      }
 985   3                      else
 986   3                      {
 987   4                              if(Tbcd[10] != 0)
 988   4                              {
 989   5                                   
 990   5                                      Tnumber(40,174,Tbcd[10]);
 991   5                      Tnumber(70,174,Tbcd[9]);
 992   5                              Txtext(100,174,".");
 993   5                              Tnumber(130,174,Tbcd[8]);
 994   5                              Tnumber(160,174,Tbcd[7]);
 995   5                                      Tnumber(190,174,Tbcd[6]);
 996   5                                      if(jishuguan_data<10)
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 18  

 997   5                                              Tnumber(490,174,jishuguan_data);             //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
 998   5                                      else if((jishuguan_data>=10)&&(jishuguan_data<100))
 999   5                                              Tnumber(460,174,jishuguan_data);
1000   5                                      else if((jishuguan_data>=100)&&(jishuguan_data<1000))
1001   5                                              Tnumber(430,174,jishuguan_data);
1002   5                                      else if((jishuguan_data>=1000)&&(jishuguan_data<10000))
1003   5                                              Tnumber(400,174,jishuguan_data);
1004   5                                      else if(jishuguan_data>=10000)
1005   5                                              Tnumber(370,174,jishuguan_data);
1006   5                               }
1007   4                               else
1008   4                               {
1009   5                      Tnumber(70,174,Tbcd[9]);
1010   5                              Txtext(100,174,".");
1011   5                              Tnumber(130,174,Tbcd[8]);
1012   5                              Tnumber(160,174,Tbcd[7]);
1013   5                                      Tnumber(190,174,Tbcd[6]);
1014   5                                      if(jishuguan_data<10)
1015   5                                              Tnumber(490,174,jishuguan_data);             //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
1016   5                                      else if((jishuguan_data>=10)&&(jishuguan_data<100))
1017   5                                              Tnumber(460,174,jishuguan_data);
1018   5                                      else if((jishuguan_data>=100)&&(jishuguan_data<1000))
1019   5                                              Tnumber(430,174,jishuguan_data);
1020   5                                      else if((jishuguan_data>=1000)&&(jishuguan_data<10000))
1021   5                                              Tnumber(400,174,jishuguan_data);
1022   5                                      else if(jishuguan_data>=10000)
1023   5                                              Tnumber(370,174,jishuguan_data);
1024   5                                      
1025   5                               }
1026   4                      }
1027   3                      if(Tbcd[5] != 0)
1028   3                      {
1029   4                              Tnumber(10,348,Tbcd[5]); 
1030   4                              Tnumber(40,348,Tbcd[4]);
1031   4                  Tnumber(70,348,Tbcd[3]);
1032   4                      Txtext(100,348,".");
1033   4                      Tnumber(130,348,Tbcd[2]);
1034   4                          Tnumber(160,348,Tbcd[1]);
1035   4                              Tnumber(190,348,Tbcd[0]);
1036   4                              if(dianlishi_data<10)
1037   4                                      Tnumber(490,348,dianlishi_data);             //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
1038   4                              else if((dianlishi_data>=10)&&(dianlishi_data<100))
1039   4                                      Tnumber(460,348,dianlishi_data);
1040   4                              else if((dianlishi_data>=100)&&(dianlishi_data<1000))
1041   4                                      Tnumber(430,348,dianlishi_data);
1042   4                              else if((dianlishi_data>=1000)&&(dianlishi_data<10000))
1043   4                                      Tnumber(400,348,dianlishi_data);
1044   4                              else if(dianlishi_data>=10000)
1045   4                                      Tnumber(370,348,dianlishi_data);
1046   4                      }
1047   3                      else
1048   3                      {
1049   4                              if(Tbcd[4] != 0)
1050   4                              { 
1051   5                                      Tnumber(40,348,Tbcd[4]);
1052   5                      Tnumber(70,348,Tbcd[3]);
1053   5                              Txtext(100,348,".");
1054   5                              Tnumber(130,348,Tbcd[2]);
1055   5                              Tnumber(160,348,Tbcd[1]);
1056   5                                      Tnumber(190,348,Tbcd[0]);
1057   5                                      if(dianlishi_data<10)
1058   5                                              Tnumber(490,348,dianlishi_data);             //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 19  

1059   5                                      else if((dianlishi_data>=10)&&(dianlishi_data<100))
1060   5                                              Tnumber(460,348,dianlishi_data);
1061   5                                      else if((dianlishi_data>=100)&&(dianlishi_data<1000))
1062   5                                              Tnumber(430,348,dianlishi_data);
1063   5                                      else if((dianlishi_data>=1000)&&(dianlishi_data<10000))
1064   5                                              Tnumber(400,348,dianlishi_data);
1065   5                                      else if(dianlishi_data>=10000)
1066   5                                              Tnumber(370,348,dianlishi_data);
1067   5                               }
1068   4                               else
1069   4                               {
1070   5                      Tnumber(70,348,Tbcd[3]);
1071   5                              Txtext(100,348,".");
1072   5                              Tnumber(130,348,Tbcd[2]);
1073   5                              Tnumber(160,348,Tbcd[1]);
1074   5                                      Tnumber(190,348,Tbcd[0]);
1075   5                                      if(dianlishi_data<10)
1076   5                                              Tnumber(490,348,dianlishi_data);             //²âÊÔÍê³ÉºóÈ¥µô   2012.6.24
1077   5                                      else if((dianlishi_data>=10)&&(dianlishi_data<100))
1078   5                                              Tnumber(460,348,dianlishi_data);
1079   5                                      else if((dianlishi_data>=100)&&(dianlishi_data<1000))
1080   5                                              Tnumber(430,348,dianlishi_data);
1081   5                                      else if((dianlishi_data>=1000)&&(dianlishi_data<10000))
1082   5                                              Tnumber(400,348,dianlishi_data);
1083   5                                      else if(dianlishi_data>=10000)
1084   5                                              Tnumber(370,348,dianlishi_data);
1085   5                               }
1086   4                      }             
1087   3      
1088   3      }
1089   2              
1090   2       }
1091   1      
1092   1      /************************************
1093   1      *           ¶ÌÑÓÊ±
1094   1      ************************************/
1095   1      void shortdelay(uint i)
*** ERROR C141 IN LINE 1095 OF 8253COUNT.C: syntax error near 'void'
1096   1      {
1097   1         uint k;
1098   1         uint n;
1099   1         for(k=0;k<i;k++)
1100   1                 for(n=200;n>0;n--);
1101   1      }       
1102          
1103          /********************************
1104          *        Ö¸Ê¾µÆºÍ±¨¾¯
1105          ********************************/
1106          void Alarm()
1107          {
1108   1              uchar n;
1109   1          for(n=0;n<10;n++)                     
1110   1          {
1111   2                   Led573=Var_Led;
1112   2                       if(Flag_Warn==1)                   //ÉùÒô±¨¾¯
1113   2                              {
1114   3                                Speak=1;      
1115   3                               }                 
1116   2         }
1117   1      }
1118          
1119          /*******************************
C51 COMPILER V7.08   8253COUNT                                                             04/11/2016 13:37:41 PAGE 20  

1120          *       ¸üÐÂÖ¸Ê¾µÆ×´Ì¬
1121          *******************************/
1122          void Updata_Flash(uchar j)
1123          {
1124   1              if(Flag_need_Flash[j])
1125   1              {
1126   2                  if(State_Flash[j]==1)
1127   2                      {
1128   3                              State_Flash[j]=0;
1129   3                      }
1130   2                      else
1131   2                      {
1132   3                              State_Flash[j]=1;
1133   3                      }
1134   2              }
1135   1              else
1136   1                              State_Flash[j]=0;
1137   1      
1138   1      }
1139          
1140          /***********************************
1141          *          Ö¸Ê¾µÆÉÁË¸
1142          ************************************/
1143          void Led_Flash(void)
1144          {
1145   1          uchar i;
1146   1              for(i=0;i<8;i++)
1147   1              {
1148   2                      Updata_Flash(i);                               //×´Ì¬È¡·´
1149   2              Led_Disp(i,Flag_need_Flash[i],State_Flash[i]); //µÆ×´Ì¬ÏÔÊ¾
1150   2              }
1151   1      }
1152          
1153          /************************************
1154          *         Ö¸Ê¾µÆ×´Ì¬ÏÔÊ¾
1155          *************************************/
1156          void Led_Disp(uchar Num,uchar Flag,uchar State)
1157          {
1158   1              if(Flag)
1159   1              {
1160   2                      if(State)
1161   2                      {
1162   3                              Var_Led=Var_Led & Svar0[Num];            //Ö¸Ê¾µÆÁÁ
1163   3                              Led573=Var_Led;
1164   3                              if(Flag_Warn==1)                        //ÐèÒª·äÃùÆ÷¹¤×÷
1165   3                              { 
1166   4                                      Speak=0;                            //·äÃùÆ÷Ïì
1167   4                                      shortdelay(100);
1168   4                              }
1169   3                              return;
1170   3                       }
1171   2              }
1172   1              Var_Led=Var_Led | Svar1[Num];                   //Ö¸Ê¾µÆÃð
1173   1              Led573=Var_Led;
1174   1              if(Flag_Warn==1)                                //ÐèÒª·äÃùÆ÷¹¤×÷
1175   1          {
1176   2                      Speak=1;                                    //·äÃùÆ÷²»Ïì
1177   2                      shortdelay(100);
1178   2                      }
1179   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  8 ERROR(S)
